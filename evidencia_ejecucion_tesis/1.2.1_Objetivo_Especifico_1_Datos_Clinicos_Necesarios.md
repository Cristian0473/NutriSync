# 1.2.1. Objetivo específico 1: Determinar qué datos clínicos resultan necesarios para formular recomendaciones nutricionales personalizadas eficaces en pacientes con diabetes tipo 2

## Alcance y trazabilidad del objetivo

El alcance se centró en el contexto del Hospital Belén de Lambayeque (HBL) y el caso de pacientes con diabetes tipo 2 (DM2) atendidos por nutricionistas. El resultado esperado fue un diccionario mínimo de variables clínicas y antropométricas que sirviera de base para el futuro modelo de recomendación, y su operativización en los formularios del sistema con validaciones en servidor y persistencia en BD.

## Procedimiento

Levantamiento de necesidades (Sprint 1): Se realizaron reuniones con personal asistencial (nutrición y administración) para delimitar el flujo: pre-registro, activación de cuenta, autenticación, registro clínico y antropometría. Se identificaron actores del sistema: administrador, nutricionista y paciente. Se definieron roles y permisos para cada actor.

Definición del diccionario mínimo (Sprints 1-2): A partir del flujo identificado, se consensuaron las variables de uso clínico habitual en DM2 y las medidas antropométricas requeridas para cálculo nutricional. Se revisó literatura científica sobre variables clínicas relevantes para recomendaciones nutricionales en diabetes tipo 2. Se consultó con nutricionistas del hospital sobre variables utilizadas en práctica clínica diaria.

Operativización en la plataforma: Se crearon y ajustaron formularios de Clínico y Antropometría en templates/admin/clinico.html y templates/admin/antropometria.html. Se implementaron validadores de entrada en servidor mediante funciones helper en main.py (_num, _num_or_none, _parse_json_list, _actividad_norm). Se diseñaron esquemas de persistencia en PostgreSQL mediante tablas clinico y antropometria con campos apropiados (DECIMAL para valores numéricos, JSON para listas, VARCHAR para categóricos).

## Resultado: diccionario mínimo de datos

Variable HbA1c (hba1c): Tipo lógico decimal. Origen módulo Clínico. Observaciones: Rango esperado 0-20; opcional. Almacenamiento en columna DECIMAL(5,2) de PostgreSQL. Validación en frontend mediante input type="number" con atributos min="0" max="20" step="0.1". Validación en backend mediante función _num que convierte string a float y verifica rango. Utilidad: Indicador de control glucémico a largo plazo (promedio de 2-3 meses). Valores mayores a 7.0% indican diabetes mal controlada. Se utiliza para ajustar calorías y distribución de macronutrientes.

Variable Glucosa en ayunas (glucosa_ayunas): Tipo lógico decimal. Origen módulo Clínico. Observaciones: mg/dL; opcional. Almacenamiento en columna DECIMAL(6,2) de PostgreSQL. Validación en frontend mediante input type="number" con atributos min="0" max="500" step="0.1". Validación en backend mediante función _num_or_none que permite valores None. Utilidad: Indicador de control glucémico inmediato. Valores mayores a 140 mg/dL indican hiperglucemia. Se utiliza para ajustar factor de diabetes en cálculo de calorías.

Variable LDL (ldl): Tipo lógico decimal. Origen módulo Clínico. Observaciones: mg/dL; opcional. Almacenamiento en columna DECIMAL(6,2) de PostgreSQL. Validación similar a glucosa en ayunas. Utilidad: Indicador de riesgo cardiovascular. Valores mayores a 130 mg/dL requieren ajuste en perfil alimentario (priorizar pescado, reducir grasas saturadas). Se utiliza en función _calcular_perfil_alimentario_paciente para ajustar priorización de alimentos.

Variable Triglicéridos (trigliceridos): Tipo lógico decimal. Origen módulo Clínico. Observaciones: mg/dL; opcional. Almacenamiento en columna DECIMAL(6,2) de PostgreSQL. Validación similar a LDL. Utilidad: Indicador de riesgo cardiovascular y control metabólico. Valores mayores a 150 mg/dL requieren ajuste en perfil alimentario (priorizar pescado, evitar carnes rojas). Se utiliza en función _calcular_perfil_alimentario_paciente para ajustar priorización de alimentos.

Variable PA sistólica (pa_sis): Tipo lógico entero. Origen módulo Clínico. Observaciones: Rango 60-250; opcional. Almacenamiento en columna SMALLINT de PostgreSQL. Validación en frontend mediante input type="number" con atributos min="60" max="250". Validación en backend mediante casting a int y verificación de rango. Utilidad: Indicador de presión arterial. Valores elevados requieren ajuste en sodio (reducir a 1500 mg/día). Se utiliza para calcular límite de sodio en metas nutricionales.

Variable PA diastólica (pa_dia): Tipo lógico entero. Origen módulo Clínico. Observaciones: Rango 40-150; opcional. Almacenamiento en columna SMALLINT de PostgreSQL. Validación similar a PA sistólica. Utilidad: Complementa PA sistólica para evaluación completa de presión arterial. Se utiliza junto con PA sistólica para determinar necesidad de reducción de sodio.

Variable Medicación (meds_json): Tipo lógico lista (JSON). Origen módulo Clínico. Observaciones: Normalizada como arreglo de strings. Almacenamiento en columna JSONB de PostgreSQL. Validación mediante función _parse_json_list que acepta JSON válido o texto separado por comas. Utilidad: Información sobre medicamentos que pueden afectar metabolismo o requerir ajustes nutricionales (ej: metformina puede causar deficiencia de B12). Se almacena para referencia futura, actualmente no se utiliza directamente en generación de planes.

Variable Otros hallazgos (otros_json): Tipo lógico lista (JSON). Origen módulo Clínico. Observaciones: Normalizada como arreglo de strings. Almacenamiento en columna JSONB de PostgreSQL. Validación similar a medicación. Utilidad: Información adicional sobre condiciones o hallazgos clínicos relevantes. Se almacena para referencia futura y posible uso en mejoras del sistema.

Variable Peso (peso): Tipo lógico decimal. Origen módulo Antropometría. Observaciones: Opcional. Almacenamiento en columna DECIMAL(5,2) de PostgreSQL. Validación mediante función _num_or_none. Utilidad: Requerido para cálculo de IMC y metabolismo basal. Se utiliza en ecuación de Mifflin-St Jeor para calcular TMB. Valores se expresan en kilogramos.

Variable Talla (talla): Tipo lógico decimal. Origen módulo Antropometría. Observaciones: Mayor a 0 para cálculo IMC. Almacenamiento en columna DECIMAL(3,2) de PostgreSQL. Validación en frontend mediante input type="number" con atributo min="0.5" max="2.5" step="0.01". Validación en backend mediante función _num_or_none y verificación de que sea mayor a 0. Utilidad: Requerido para cálculo de IMC y metabolismo basal. Se utiliza en ecuación de Mifflin-St Jeor para calcular TMB. Valores se expresan en metros.

Variable Circunferencia de cintura (cc): Tipo lógico decimal. Origen módulo Antropometría. Observaciones: Opcional. Almacenamiento en columna DECIMAL(5,2) de PostgreSQL. Validación similar a peso. Utilidad: Indicador de grasa abdominal y riesgo cardiovascular. Valores elevados (mayor a 102 cm en hombres, mayor a 88 cm en mujeres) indican riesgo aumentado. Actualmente se almacena para referencia futura, no se utiliza directamente en generación de planes.

Variable Porcentaje de grasa (bf_pct): Tipo lógico decimal. Origen módulo Antropometría. Observaciones: Opcional. Almacenamiento en columna DECIMAL(5,2) de PostgreSQL. Validación similar a peso. Utilidad: Indicador de composición corporal. Valores elevados (mayor a 25% en hombres, mayor a 35% en mujeres) indican sobrepeso u obesidad. Actualmente se almacena para referencia futura, no se utiliza directamente en generación de planes.

Variable Actividad física (actividad): Tipo lógico categórica. Origen módulo Antropometría. Observaciones: Valores controlados {baja, moderada, alta}. Almacenamiento en columna VARCHAR(10) de PostgreSQL. Validación mediante función _actividad_norm que mapea variaciones de texto a valores canónicos. Utilidad: Requerido para cálculo de factor de actividad en metabolismo basal. Se utiliza en función calcular_factor_actividad que retorna multiplicadores: baja 1.2, moderada 1.4, alta 1.6.

Variable IMC: Tipo lógico derivada (UI). Origen módulo Antropometría. Observaciones: Calculado como peso/(talla^2); solo se muestra en vista, no se persiste. Cálculo en frontend mediante JavaScript que lee valores de peso y talla, calcula IMC, y muestra resultado en tiempo real. Utilidad: Indicador de estado nutricional. Valores menores a 18.5 indican bajo peso, 18.5-24.9 normal, 25-29.9 sobrepeso, mayor o igual a 30 obesidad. Se utiliza en función calcular_factor_diabetes para ajustar calorías según estado nutricional.

## Justificación de variables seleccionadas

Variables clínicas esenciales: HbA1c y glucosa en ayunas son esenciales para evaluar control glucémico, requisito fundamental para ajustar recomendaciones nutricionales en diabetes. LDL y triglicéridos son esenciales para evaluar riesgo cardiovascular, permitiendo ajustar perfil alimentario hacia alimentos cardioprotectores. PA sistólica y diastólica son esenciales para determinar necesidad de reducción de sodio, importante en pacientes con hipertensión (común en diabetes).

Variables antropométricas esenciales: Peso y talla son esenciales para cálculo de IMC y metabolismo basal, base de todo cálculo nutricional. Actividad física es esencial para ajustar metabolismo basal según nivel de actividad, permitiendo cálculo preciso de necesidades calóricas.

Variables complementarias: Circunferencia de cintura y porcentaje de grasa proporcionan información adicional sobre composición corporal, útil para evaluaciones futuras pero no críticas para generación inicial de planes. Medicación y otros hallazgos proporcionan contexto clínico adicional, útil para referencia pero no utilizados directamente en algoritmos actuales.

## Integración en el sistema

Formularios de captura: Se implementaron formularios HTML con validación en frontend mediante atributos HTML5 (type="number", min, max, step) y JavaScript. Se implementó validación en backend mediante funciones helper que convierten y validan valores antes de persistencia. Se implementó manejo de errores con mensajes descriptivos cuando validación falla.

Persistencia en base de datos: Se diseñaron tablas clinico y antropometria con tipos de datos apropiados (DECIMAL para numéricos, JSONB para listas, VARCHAR para categóricos). Se implementaron relaciones mediante claves foráneas (paciente_id) para mantener integridad referencial. Se implementó seguimiento histórico mediante campo fecha que permite múltiples registros por paciente.

Uso en algoritmos: Las variables se utilizan en múltiples funciones del motor de recomendación: calcular_metabolismo_basal utiliza peso, talla, edad y sexo. calcular_factor_diabetes utiliza IMC, HbA1c y glucosa en ayunas. calcular_metas_nutricionales utiliza todas las variables clínicas para ajustar metas. _calcular_perfil_alimentario_paciente utiliza HbA1c, glucosa, triglicéridos, LDL e IMC para priorizar alimentos.

## Validación del diccionario

Revisión con expertos: Se presentó diccionario propuesto a nutricionistas del hospital para validación. Se recibió retroalimentación sobre variables adicionales que podrían ser útiles (ej: creatinina para función renal). Se decidió mantener diccionario mínimo inicial y considerar expansión futura según necesidades.

Pruebas de uso: Se probó captura de datos con 10 pacientes de prueba con diferentes perfiles. Se verificó que todas las variables se capturan correctamente y se persisten en base de datos. Se verificó que las variables se utilizan correctamente en algoritmos de generación de planes.

Resultado final: El diccionario mínimo definido permite generar recomendaciones nutricionales personalizadas efectivas para pacientes con diabetes tipo 2, balanceando completitud de información con practicidad de captura en contexto clínico real.

